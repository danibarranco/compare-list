<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Comparador de listas</title>
  <style>
    :root{--bg:#f7f6fb;--surface:#ffffff;--muted:#6b6b6b;--text:#0f1720;--accent:#7c59f2;--card-shadow:0 8px 24px rgba(12,12,30,0.06);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;margin:0}
    [data-theme="dark"]{--bg:#071025;--surface:#0b0f14;--muted:#95a0b8;--text:#e6eef8;--accent:#8f7bf8;--card-shadow:0 18px 48px rgba(0,0,0,0.6)}
    body{padding:24px;background:var(--bg);color:var(--text);transition:background .2s ease,color .2s ease}
    h1{margin:0 0 12px}
    .container{max-width:1100px;margin:0 auto}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:32px;margin-bottom:18px;align-items:start}
    .cols > div{box-sizing:border-box}
    textarea{box-sizing:border-box}
    textarea{width:100%;min-height:240px;padding:16px;border-radius:10px;border:1px solid color-mix(in srgb,var(--surface) 60%, black 4%);resize:vertical;background:linear-gradient(180deg, color-mix(in srgb,var(--surface) 98%, black 1%), color-mix(in srgb,var(--surface) 95%, black 3%));box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);color:var(--text);font-family:monospace}
    /* add visual separation between inputs */
    .cols > div{padding:8px;background:linear-gradient(180deg, color-mix(in srgb,var(--surface) 94%, var(--bg) 6%), color-mix(in srgb,var(--surface) 90%, var(--bg) 10%));border-radius:12px;border:1px solid rgba(15,15,20,0.04)}
    .controls{margin:18px 0 6px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer;box-shadow:var(--card-shadow);transition:transform .12s ease,box-shadow .12s}
    button:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(107,92,231,0.18)}
    button.secondary{background:transparent;color:var(--muted);box-shadow:none;border:1px solid rgba(15,15,20,0.04);padding:8px 12px}
    .theme-toggle{margin-left:auto;background:transparent;border:1px solid rgba(15,15,20,0.06);padding:6px 10px;border-radius:8px;color:var(--muted);min-width:44px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
    .theme-toggle:hover{background:color-mix(in srgb,var(--surface) 94%, var(--accent) 2%)}
    .theme-toggle:focus{outline:2px solid color-mix(in srgb,var(--accent) 30%, transparent);outline-offset:3px}
    .results{margin-top:28px;display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .controls{margin-bottom:18px}
    .card{background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--card-shadow);min-height:140px;border:1px solid color-mix(in srgb,var(--surface) 60%, black 6%)}
    .card h3{margin:0 0 8px;font-size:1rem;color:var(--text);font-weight:600}
    /* fixed card height with internal scroll for long content */
    .card{max-height:220px;display:flex;flex-direction:column}
    .card pre{flex:1;overflow:auto;padding-right:6px;color:var(--text)}
    /* ensure textarea fits within its parent and not overflow */
    .cols textarea{width:100%;height:220px}
    /* highlight center column */
    .card.center{background:linear-gradient(180deg,color-mix(in srgb,var(--accent) 10%, transparent 90%), color-mix(in srgb,var(--accent) 4%, transparent 96%));border:1px solid color-mix(in srgb,var(--accent) 20%, transparent);box-shadow:0 24px 60px color-mix(in srgb,var(--accent) 12%, rgba(0,0,0,0.12));transform:translateY(-4px)}
    .muted{color:var(--muted)}
    /* ensure cards align with inputs above */
    .results, .cols{max-width:1100px;margin:0 auto}
    pre{white-space:pre-wrap;margin:0;font-family:inherit;color:var(--text)}
    .footer{margin-top:22px;color:var(--muted);font-size:0.95rem}
    .small{font-size:0.9rem;color:var(--muted)}
    @media (max-width:700px){
      .cols{grid-template-columns:1fr;gap:12px}
      .results{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Comparador de listas</h1>
    <p class="small">Pega una lista por l√≠nea en cada campo. Usa las opciones para normalizar elementos (trim, lowercase) y pulsa "Comparar".</p>

    <div class="cols">
    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <label><strong>Lista A</strong></label>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="small">Total: <span id="totalA">0</span></span>
          <button id="clearA" class="secondary" title="Limpiar lista A">Limpiar A</button>
          <button id="sortA" class="secondary" title="Ordenar lista A">Ordenar A</button>
        </div>
      </div>
      <textarea id="listA" placeholder="Elemento 1\nElemento 2\n...">Manzana
Pera
Pl√°tano
pera
Kiwi
Manzana</textarea>
    </div>
    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <label><strong>Lista B</strong></label>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="small">Total: <span id="totalB">0</span></span>
          <button id="clearB" class="secondary" title="Limpiar lista B">Limpiar B</button>
          <button id="sortB" class="secondary" title="Ordenar lista B">Ordenar B</button>
        </div>
      </div>
      <textarea id="listB" placeholder="Elemento 1\nElemento 2\n...">pera
Uva
Manzana
Pi√±a
kiwi
Mandarina</textarea>
    </div>
  </div>

  <div class="controls">
    <label class="small"><input type="checkbox" id="trim" checked> Trim</label>
    <label class="small"><input type="checkbox" id="lower" checked> Lowercase</label>
    <label class="small"><input type="checkbox" id="ignoreEmpty" checked> Ignorar l√≠neas vac√≠as</label>
    <button id="compare">Comparar</button>
    <button id="clear" class="secondary">Limpiar</button>
    <button id="swap" class="secondary">Intercambiar</button>
    <div class="small" style="align-self:center">Atajo: Ctrl/Cmd + Enter para comparar</div>
    <button id="themeToggle" class="theme-toggle" title="Alternar tema">Tema</button>
  </div>

  <div class="results">
    <div class="card">
      <h3 id="h3DiffA">Diferencias (A \ B) <span class="small" id="countDiffA">(0)</span></h3>
      <pre id="diffA">-</pre>
      <div class="actions"><button data-target="diffA" class="copy">Copiar</button></div>
    </div>
    <div class="card center">
      <h3 id="h3Inter">Intersecci√≥n <span class="small" id="countInter">(0)</span> <span class="muted" id="pctInter"></span></h3>
      <pre id="inter">-</pre>
      <div class="actions"><button data-target="inter" class="copy">Copiar</button></div>
    </div>
    <div class="card">
      <h3 id="h3DiffB">Diferencias (B \ A) <span class="small" id="countDiffB">(0)</span></h3>
      <pre id="diffB">-</pre>
      <div class="actions"><button data-target="diffB" class="copy">Copiar</button></div>
    </div>
  </div>

  <div class="results" style="margin-top:12px">
    <div class="card">
      <h3 id="h3DupsA">Duplicados A <span class="small" id="countDupsA">(0)</span></h3>
      <pre id="dupsA">-</pre>
      <div class="actions"><button data-target="dupsA" class="copy">Copiar</button><button id="dedupeA" class="secondary">Eliminar duplicados A</button></div>
    </div>
    <div class="card center">
      <h3 id="h3DupsAll">Duplicados (ambas) <span class="small" id="countDupsAll">(0)</span></h3>
      <pre id="dups">-</pre>
      <div class="actions"><button data-target="dups" class="copy">Copiar</button></div>
    </div>
    <div class="card">
      <h3 id="h3DupsB">Duplicados B <span class="small" id="countDupsB">(0)</span></h3>
      <pre id="dupsB">-</pre>
      <div class="actions"><button data-target="dupsB" class="copy">Copiar</button><button id="dedupeB" class="secondary">Eliminar duplicados B</button></div>
    </div>
  </div>

    <div class="footer">Auto generado. Si quieres opciones extra (CSV input, export JSON), dime y lo a√±ado.</div>
  </div>

  <script>
    function parse(text, opts){
      const lines = text.split(/\r?\n/);
      const out = [];
      for(let l of lines){
        if(opts.trim) l = l.trim();
        if(opts.lower) l = l.toLowerCase();
        if(opts.ignoreEmpty && l === '') continue;
        out.push(l);
      }
      return out;
    }

    function uniq(arr){
      return Array.from(new Set(arr));
    }

    function counts(arr){
      const m = new Map();
      for(const v of arr){ m.set(v, (m.get(v)||0)+1); }
      return m;
    }

    function compare(){
      const opts = {trim:document.getElementById('trim').checked, lower:document.getElementById('lower').checked, ignoreEmpty:document.getElementById('ignoreEmpty').checked}
      const aRaw = document.getElementById('listA').value;
      const bRaw = document.getElementById('listB').value;
      const a = parse(aRaw, opts);
      const b = parse(bRaw, opts);
      const setA = new Set(a);
      const setB = new Set(b);

      // totals (after normalization)
      document.getElementById('totalA').textContent = a.length;
      document.getElementById('totalB').textContent = b.length;

      const diffA = [...setA].filter(x=>!setB.has(x));
      const diffB = [...setB].filter(x=>!setA.has(x));
      const inter = [...setA].filter(x=>setB.has(x));

      const dupA = [...counts(a)].filter(([k,v])=>v>1).map(([k,v])=>`${k} (x${v})`);
      const dupB = [...counts(b)].filter(([k,v])=>v>1).map(([k,v])=>`${k} (x${v})`);
      const dupAll = uniq(dupA.concat(dupB));

      document.getElementById('diffA').textContent = diffA.length?diffA.join('\n'):'(ninguno)';
      document.getElementById('diffB').textContent = diffB.length?diffB.join('\n'):'(ninguno)';
      document.getElementById('inter').textContent = inter.length?inter.join('\n'):'(ninguno)';
      document.getElementById('dupsA').textContent = dupA.length?dupA.join('\n'):'(ninguno)';
      document.getElementById('dupsB').textContent = dupB.length?dupB.join('\n'):'(ninguno)';
      document.getElementById('dups').textContent = dupAll.length?dupAll.join('\n'):'(ninguno)';

      // update counts in headings
      document.getElementById('countDiffA').textContent = `(${diffA.length})`;
      document.getElementById('countDiffB').textContent = `(${diffB.length})`;
      document.getElementById('countInter').textContent = `(${inter.length})`;
      // percentages relative to totals
      const pctA = a.length? Math.round((inter.length / a.length)*100) : 0;
      const pctB = b.length? Math.round((inter.length / b.length)*100) : 0;
      document.getElementById('pctInter').textContent = `‚Äî ${pctA}% de A ¬∑ ${pctB}% de B`;

      document.getElementById('countDupsA').textContent = `(${dupA.length})`;
      document.getElementById('countDupsB').textContent = `(${dupB.length})`;
      document.getElementById('countDupsAll').textContent = `(${dupAll.length})`;
    }

    document.getElementById('compare').addEventListener('click', compare);
    document.getElementById('clear').addEventListener('click', ()=>{document.getElementById('listA').value='';document.getElementById('listB').value='';compare();});
    document.getElementById('swap').addEventListener('click', ()=>{const a = document.getElementById('listA').value;document.getElementById('listA').value = document.getElementById('listB').value;document.getElementById('listB').value = a;compare();});

    document.querySelectorAll('.copy').forEach(btn=>btn.addEventListener('click', async e=>{
      const t = document.getElementById(e.currentTarget.dataset.target).textContent;
      const el = e.currentTarget;
      try{ 
        await navigator.clipboard.writeText(t);
        // visual state: set copied class and text
        el.classList.add('copied');
        const prev = el.textContent;
        el.textContent = 'Copiado';
        // keep green state briefly then revert
        clearTimeout(el._copiedTimer);
        el._copiedTimer = setTimeout(()=>{ el.classList.remove('copied'); el.textContent = prev; }, 2000);
      }catch(err){alert('No se pudo copiar. Usa selecci√≥n y ctrl+c');}
    }));

    // theme handling: detect prefers-color-scheme and allow toggle
    const themeToggle = document.getElementById('themeToggle');
    function applyTheme(t){
      if(t === 'dark') document.documentElement.setAttribute('data-theme','dark');
      else document.documentElement.removeAttribute('data-theme');
    }
    // initial: from localStorage or prefers
    const saved = localStorage.getItem('listCompareTheme');
    if(saved){ applyTheme(saved); }
    else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){ applyTheme('dark'); }

    function updateThemeButton(){
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      themeToggle.setAttribute('aria-label', isDark ? 'Cambiar a claro' : 'Cambiar a oscuro');
    }
    themeToggle.addEventListener('click', ()=>{
      const now = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      applyTheme(now);
      localStorage.setItem('listCompareTheme', now);
      updateThemeButton();
    });
    // initialize theme button state
    updateThemeButton();

    // keyboard shortcut: Ctrl/Cmd + Enter inside either textarea triggers compare
    const taA = document.getElementById('listA');
    const taB = document.getElementById('listB');
    function handleKey(e){
      if(e.key === 'Enter' && (e.ctrlKey || e.metaKey)){
        e.preventDefault();
        compare();
      }
    }
    taA.addEventListener('keydown', handleKey);
    taB.addEventListener('keydown', handleKey);

    // clear individual lists
    document.getElementById('clearA').addEventListener('click', ()=>{document.getElementById('listA').value=''; compare();});
    document.getElementById('clearB').addEventListener('click', ()=>{document.getElementById('listB').value=''; compare();});

    // remove duplicates from a list (keep first occurrence)
    document.getElementById('dedupeA').addEventListener('click', ()=>{
      const opts = {trim:document.getElementById('trim').checked, lower:document.getElementById('lower').checked, ignoreEmpty:document.getElementById('ignoreEmpty').checked};
      const a = parse(document.getElementById('listA').value, opts);
      const unique = uniq(a);
      document.getElementById('listA').value = unique.join('\n');
      compare();
    });
    document.getElementById('dedupeB').addEventListener('click', ()=>{
      const opts = {trim:document.getElementById('trim').checked, lower:document.getElementById('lower').checked, ignoreEmpty:document.getElementById('ignoreEmpty').checked};
      const b = parse(document.getElementById('listB').value, opts);
      const unique = uniq(b);
      document.getElementById('listB').value = unique.join('\n');
      compare();
    });

    // sort list A/B (alphabetical)
    document.getElementById('sortA').addEventListener('click', ()=>{
      const opts = {trim:document.getElementById('trim').checked, lower:document.getElementById('lower').checked, ignoreEmpty:document.getElementById('ignoreEmpty').checked};
      const a = parse(document.getElementById('listA').value, opts);
      a.sort((x,y)=>x.localeCompare(y, undefined, {sensitivity: 'base'}));
      document.getElementById('listA').value = a.join('\n');
      compare();
    });
    document.getElementById('sortB').addEventListener('click', ()=>{
      const opts = {trim:document.getElementById('trim').checked, lower:document.getElementById('lower').checked, ignoreEmpty:document.getElementById('ignoreEmpty').checked};
      const b = parse(document.getElementById('listB').value, opts);
      b.sort((x,y)=>x.localeCompare(y, undefined, {sensitivity: 'base'}));
      document.getElementById('listB').value = b.join('\n');
      compare();
    });

    // initial compare
    compare();
  </script>
</body>
</html>